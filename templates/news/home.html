{% extends 'base.html' %}
{% load static %}
{% load rich_text_filters %}

{% block title %}Daily News Flow - Professional News & Financial Insights{% endblock %}

{% block description %}Stay ahead with professional news coverage, real-time market data, currency exchange rates, and stock market updates. Your trusted source for global financial insights.{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container-fluid">
        <!-- Professional News Filter Section -->
        <div class="row justify-content-center">
            <div class="col-12 col-xl-10">
                <div class="hero-filter-section">
                    <h3 class="filter-title">
                        <i class="fas fa-filter me-2"></i>
                        Advanced News Filter
                    </h3>
                    
                    <form class="filter-form" method="get" action="{% url 'news:home' %}" id="newsFilterForm">
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-calendar-alt me-1"></i>Date Range
                            </label>
                            <input type="date" 
                                   name="from_date" 
                                   class="filter-input" 
                                   value="{{ request.GET.from_date }}"
                                   max="{{ today|date:'Y-m-d' }}"
                                   title="Filter news from this date">
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-globe me-1"></i>Country
                            </label>
                            <select name="country" class="filter-select" title="Filter by country">
                                <option value="">All Countries</option>
                                {% for country in countries %}
                                <option value="{{ country.code }}" 
                                        {% if request.GET.country == country.code %}selected{% endif %}>
                                    {{ country.name }}
                                    {% if country.article_count %}({{ country.article_count }}){% endif %}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <button type="submit" class="filter-btn" title="Apply filters">
                                <i class="fas fa-search me-1"></i>
                                Filter
                            </button>
                        </div>
                    </form>
                    
                    <!-- Quick Filter Tabs -->
                    <div class="quick-filter-tabs">
                        <a href="{% url 'news:home' %}" 
                           class="quick-filter-tab {% if not request.GET.from_date and not request.GET.country and not request.GET.category %}active{% endif %}">
                            <i class="fas fa-globe-americas me-1"></i>All News
                        </a>
                        <a href="{% url 'news:home' %}?from_date={{ today|date:'Y-m-d' }}" 
                           class="quick-filter-tab {% if request.GET.from_date == today|date:'Y-m-d' %}active{% endif %}">
                            <i class="fas fa-clock me-1"></i>Today
                        </a>
                        <a href="{% url 'news:home' %}?from_date={{ week_ago|date:'Y-m-d' }}" 
                           class="quick-filter-tab {% if request.GET.from_date == week_ago|date:'Y-m-d' %}active{% endif %}">
                            <i class="fas fa-calendar-week me-1"></i>This Week
                        </a>
                        {% for category in categories %}
                        <a href="{% url 'news:home' %}?category={{ category.slug }}" 
                           class="quick-filter-tab {% if request.GET.category == category.slug %}active{% endif %}">
                            <i class="{{ category.icon }} me-1"></i>{{ category.name }}
                        </a>
                        {% endfor %}
                    </div>
                    
                    <!-- Filter Statistics -->
                    <div class="filter-stats">
                        <div class="filter-stat">
                            <span class="filter-stat-number" id="filteredArticles">{{ total_articles|default:"0" }}</span>
                            <span class="filter-stat-label">Articles Found</span>
                        </div>
                        <div class="filter-stat">
                            <span class="filter-stat-number">{{ total_countries|default:"0" }}</span>
                            <span class="filter-stat-label">Countries</span>
                        </div>
                        <div class="filter-stat">
                            <span class="filter-stat-number">{{ total_providers|default:"0" }}</span>
                            <span class="filter-stat-label">News Sources</span>
                        </div>
                        <div class="filter-stat">
                            <span class="filter-stat-number">Live</span>
                            <span class="filter-stat-label">Updates</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Main Content -->
<div class="container my-5">
    <div class="row">
        <!-- Main Content Column -->
        <div class="col-lg-8">
            <!-- Latest News Section -->
            <section class="mb-5">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="section-title">
                        <i class="fas fa-newspaper me-2"></i>Latest News
                    </h2>
                    <a href="{% url 'news:all_news' %}" class="btn btn-outline-primary">
                        View All <i class="fas fa-arrow-right ms-1"></i>
                    </a>
                </div>

                {% if recent_articles %}
                <div class="row g-4">
                    {% for article in recent_articles %}
                    <div class="col-md-6">
                        <div class="card news-card h-100 shadow-sm">
                            {% if article.image %}
                            <div class="position-relative">
                                <img src="{{ article.image }}" 
                                     class="card-img-top news-image" 
                                     alt="{{ article.title }}"
                                     style="height: 200px; object-fit: cover;">
                                {% if article.category %}
                                <span class="position-absolute top-0 start-0 m-2 badge category-badge"
                                      style="background-color: {{ article.category.color|default:'#007bff' }};">
                                    <i class="{{ article.category.icon }} me-1"></i>{{ article.category.name }}
                                </span>
                                {% endif %}
                                <span class="position-absolute top-0 end-0 m-2 badge bg-dark">
                                    <i class="fas fa-flag me-1"></i>{{ article.country.code }}
                                </span>
                            </div>
                            {% else %}
                            <div class="card-img-top bg-light d-flex align-items-center justify-content-center" 
                                 style="height: 200px;">
                                <div class="text-center">
                                    <i class="fas fa-newspaper fa-3x text-muted mb-2"></i>
                                    {% if article.category %}
                                    <div>
                                        <span class="badge category-badge"
                                              style="background-color: {{ article.category.color|default:'#007bff' }};">
                                            <i class="{{ article.category.icon }} me-1"></i>{{ article.category.name }}
                                        </span>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                            
                            <div class="card-body d-flex flex-column">
                                <div class="news-meta mb-2">
                                    <small class="text-muted">
                                        <i class="fas fa-clock me-1"></i>{{ article.date_posted|timesince }} ago
                                        <span class="mx-1">â€¢</span>
                                        {{ article.news_provider.name|truncatechars:20 }}
                                    </small>
                                </div>
                                
                                <h5 class="card-title news-title">
                                    <a href="{% url 'news:article_detail' article.pk %}" 
                                       class="text-decoration-none text-dark stretched-link">
                                        {{ article.title }}
                                    </a>
                                </h5>
                                
                                {% if article.description %}
                                <p class="card-text text-muted mb-3">
                                    {{ article.description|smart_truncate_html:100 }}
                                </p>
                                {% endif %}
                                
                                <div class="mt-auto">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="badge bg-light text-dark">{{ article.country.name }}</span>
                                        <div class="article-actions position-relative" style="z-index: 10;">
                                            <a href="{% url 'news:article_detail' article.pk %}"
                                               class="btn btn-sm btn-primary position-relative"
                                               style="z-index: 15;">
                                                <i class="fas fa-eye me-1"></i>Read
                                            </a>
                                            <a href="{{ article.link }}" target="_blank"
                                               class="btn btn-sm btn-outline-secondary position-relative ms-1"
                                               style="z-index: 15;">
                                                <i class="fas fa-external-link-alt me-1"></i>Source
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-inbox fa-4x text-muted mb-3"></i>
                    <h4 class="text-muted">No news articles available</h4>
                    <p class="text-muted">Articles will appear here once they are published.</p>
                </div>
                {% endif %}
            </section>

            <!-- Social Media Section -->
            {% if social_posts %}
            <section class="mb-5">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="section-title">
                        <i class="fas fa-share-alt me-2"></i>Social Media Updates
                    </h2>
                    <div class="d-flex align-items-center">
                        <span class="badge bg-success me-2">
                            <i class="fas fa-circle me-1" style="font-size: 0.5rem;"></i>Live
                        </span>
                        <a href="{% url 'news:all_social_posts' %}" class="btn btn-outline-primary btn-sm">
                            View All
                        </a>
                    </div>
                </div>

                <div class="row g-4">
                    {% for post in social_posts|slice:":4" %}
                    <div class="col-md-6">
                        <div class="card social-post-card h-100 shadow-sm">
                            <div class="card-body">
                                <div class="d-flex align-items-start mb-3">
                                    {% if post.author_avatar %}
                                    <img src="{{ post.author_avatar }}" 
                                         alt="{{ post.author_name }}" 
                                         class="rounded-circle me-3" 
                                         style="width: 40px; height: 40px; object-fit: cover;">
                                    {% else %}
                                    <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center me-3" 
                                         style="width: 40px; height: 40px;">
                                        <i class="fas fa-user text-white"></i>
                                    </div>
                                    {% endif %}
                                    
                                    <div class="flex-grow-1">
                                        <div class="d-flex justify-content-between align-items-start mb-1">
                                            <div>
                                                <strong class="d-block">{{ post.author_name }}</strong>
                                                {% if post.author_handle %}
                                                <small class="text-muted">{{ post.author_handle }}</small>
                                                {% endif %}
                                            </div>
                                            <small class="text-muted">{{ post.created_at|timesince }} ago</small>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <i class="fab fa-{{ post.platform|lower }} me-1 text-primary"></i>
                                            <span class="badge bg-light text-dark">{{ post.get_platform_display }}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="social-content mb-3">
                                    {{ post.content|smart_truncate_html:120 }}
                                </div>
                                
                                {% if post.image %}
                                <div class="mb-3">
                                    <img src="{{ post.image }}" 
                                         alt="Post image" 
                                         class="img-fluid rounded" 
                                         style="max-height: 200px; width: 100%; object-fit: cover;">
                                </div>
                                {% endif %}
                                
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="social-engagement">
                                        <span class="me-3">
                                            <i class="fas fa-heart text-danger me-1"></i>{{ post.likes|floatformat:0 }}
                                        </span>
                                        <span class="me-3">
                                            <i class="fas fa-share text-primary me-1"></i>{{ post.shares|floatformat:0 }}
                                        </span>
                                        <span>
                                            <i class="fas fa-comment text-info me-1"></i>{{ post.comments|floatformat:0 }}
                                        </span>
                                    </div>
                                    <div class="social-actions">
                                        {% if post.external_url %}
                                        <a href="{{ post.external_url }}" 
                                           target="_blank" 
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-external-link-alt me-1"></i>View
                                        </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Markets Widget -->
            <div class="card sidebar-widget mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-line me-2"></i>Financial Markets
                    </h5>
                </div>
                <div class="card-body text-center">
                    <div class="mb-3">
                        <i class="fas fa-chart-pie fa-3x text-primary mb-3"></i>
                        <h6>Real-time Market Data</h6>
                        <p class="text-muted small">Track stocks, forex, commodities and crypto</p>
                    </div>
                    <a href="{% url 'news:markets' %}" class="btn btn-primary">
                        <i class="fas fa-chart-line me-2"></i>View Markets
                    </a>
                    
                    <div class="row g-2 mt-3">
                        <div class="col-3">
                            <div class="text-center">
                                <i class="fas fa-chart-line text-primary"></i>
                                <small class="d-block text-muted">Stocks</small>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="text-center">
                                <i class="fas fa-coins text-warning"></i>
                                <small class="d-block text-muted">Forex</small>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="text-center">
                                <i class="fas fa-gem text-success"></i>
                                <small class="d-block text-muted">Commodities</small>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="text-center">
                                <i class="fab fa-bitcoin text-info"></i>
                                <small class="d-block text-muted">Crypto</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Countries Widget -->
            <div class="card sidebar-widget">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-globe me-2"></i>News by Country
                    </h5>
                </div>
                <div class="card-body">
                    {% for country in top_countries %}
                    <div class="d-flex justify-content-between align-items-center py-2 {% if not forloop.last %}border-bottom{% endif %}">
                        <div class="d-flex align-items-center">
                            {% if country.flag_url %}
                            <img src="{{ country.flag_url }}" 
                                 alt="{{ country.name }}" 
                                 class="me-2"
                                 style="width: 24px; height: 18px; border-radius: 2px;">
                            {% endif %}
                            <span>{{ country.name }}</span>
                        </div>
                        <span class="badge bg-primary">{{ country.article_count }}</span>
                    </div>
                    {% empty %}
                    <p class="text-muted text-center mb-0">No country data available</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Enhanced Filter Functionality
    const filterForm = document.getElementById('newsFilterForm');
    if (filterForm) {
        const countrySelect = filterForm.querySelector('select[name="country"]');
        const dateInput = filterForm.querySelector('input[name="from_date"]');
        
        // Auto-submit when filters change
        if (countrySelect) {
            countrySelect.addEventListener('change', function() {
                filterForm.submit();
            });
        }
        
        if (dateInput) {
            dateInput.addEventListener('change', function() {
                filterForm.submit();
            });
        }
    }
    
    // Card hover effects
    document.querySelectorAll('.news-card, .social-post-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.transition = 'transform 0.3s ease';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
});
</script>

<style>
/* Professional Styling */
.hero-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 400px;
    display: flex;
    align-items: center;
    position: relative;
    overflow: hidden;
}

.hero-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.3);
    z-index: 1;
}

.hero-section .container-fluid {
    position: relative;
    z-index: 2;
    max-width: 1400px;
    margin: 0 auto;
    padding-left: 20px;
    padding-right: 20px;
}

.hero-filter-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 10px 15px rgba(0,0,0,0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    position: relative;
    overflow: hidden;
    margin: 0 auto;
    max-width: 100%;
}

.hero-filter-section::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.hero-filter-section:hover::before {
    opacity: 1;
}

.filter-title {
    color: #007bff;
    font-weight: 700;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
    text-align: center;
}

.filter-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    align-items: end;
    margin-bottom: 1.5rem;
}

.filter-group {
    display: flex;
    flex-direction: column;
}

.filter-label {
    font-weight: 600;
    color: #343a40;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}

.filter-input,
.filter-select {
    padding: 0.75rem;
    border: 2px solid #e9ecef;
    border-radius: 0.5rem;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    background: white;
}

.filter-input:focus,
.filter-select:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    outline: none;
    transform: scale(1.02);
}

.filter-btn {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.filter-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    background: linear-gradient(135deg, #0056b3 0%, #007bff 100%);
}

/* Quick Filter Tabs */
.quick-filter-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    justify-content: center;
    margin-bottom: 1.5rem;
}

.quick-filter-tab {
    padding: 0.5rem 1rem;
    background: white;
    color: #007bff;
    text-decoration: none;
    border-radius: 2rem;
    font-weight: 500;
    font-size: 0.85rem;
    transition: all 0.3s ease;
    border: 2px solid #007bff;
}

.quick-filter-tab:hover,
.quick-filter-tab.active {
    background: #007bff;
    color: white;
    transform: translateY(-1px);
}

/* Filter Statistics */
.filter-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 1rem;
    margin-top: 1.5rem;
}

.filter-stat {
    text-align: center;
    padding: 1rem;
    background: white;
    border-radius: 0.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
}

.filter-stat-number {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: #007bff;
    margin-bottom: 0.25rem;
}

.filter-stat-label {
    font-size: 0.8rem;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.section-title {
    font-size: 1.75rem;
    font-weight: 700;
    color: #333;
    margin-bottom: 0;
}

.news-card, .social-post-card {
    border: none;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border-radius: 12px;
    transition: all 0.3s ease;
}

.news-card:hover, .social-post-card:hover {
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.news-image {
    border-radius: 12px 12px 0 0;
}

.category-badge {
    font-size: 0.75rem;
    font-weight: 600;
    padding: 4px 8px;
    border-radius: 12px;
}

.news-title {
    font-size: 1.1rem;
    font-weight: 600;
    line-height: 1.4;
}

.news-title a {
    color: #333;
    transition: color 0.3s ease;
}

.news-title a:hover {
    color: #007bff;
}

.sidebar-widget {
    border: none;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border-radius: 12px;
}

.sidebar-widget .card-header {
    background: linear-gradient(45deg, #f8f9fa, #e9ecef);
    border-bottom: 1px solid #dee2e6;
    border-radius: 12px 12px 0 0;
}

.article-actions .btn {
    font-size: 0.85rem;
    padding: 0.375rem 0.75rem;
    border-radius: 6px;
}

.social-engagement {
    font-size: 0.9rem;
}

.social-engagement span {
    color: #6c757d;
}

.social-content {
    font-size: 0.95rem;
    line-height: 1.5;
    color: #333;
}

@media (max-width: 768px) {
    .hero-section {
        padding: 40px 0;
        min-height: 300px;
    }
    
    .hero-filter-section {
        padding: 1.5rem;
        margin: 1rem;
    }
    
    .filter-title {
        font-size: 1.25rem;
    }
    
    .filter-form {
        grid-template-columns: 1fr;
        gap: 0.75rem;
    }
    
    .filter-stats {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .quick-filter-tabs {
        justify-content: flex-start;
        overflow-x: auto;
        padding-bottom: 0.5rem;
    }
    
    .quick-filter-tab {
        white-space: nowrap;
        flex-shrink: 0;
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
    }
    
    .section-title {
        font-size: 1.5rem;
    }
    
    .container-fluid {
        padding-left: 15px;
        padding-right: 15px;
    }
}

@media (max-width: 1200px) {
    .filter-form {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
}

@media (max-width: 576px) {
    .hero-filter-section {
        padding: 1rem;
        margin: 0.5rem;
    }
    
    .filter-title {
        font-size: 1.1rem;
    }
    
    .filter-group {
        margin-bottom: 0.75rem;
    }
    
    .quick-filter-tab {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
    }
    
    .container-fluid {
        padding-left: 10px;
        padding-right: 10px;
    }
}
</style>
{% endblock %}
